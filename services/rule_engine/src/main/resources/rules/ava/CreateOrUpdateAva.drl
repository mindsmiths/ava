package rules.ava;

import com.mindsmiths.employeeManager.employees.Employee;
import com.mindsmiths.sdk.utils.Utils;
import com.mindsmiths.ruleEngine.util.Agents;

import signals.EmployeeUpdateSignal;
import signals.EmployeeTestSignal;
import signals.AllEmployees;
import signals.EmployeeConnectionStrengthsSignal;

import agents.CultureMaster;
import agents.Ava;

import models.EmployeeProfile;
import models.OnboardingStage;

rule "Create new employee"
    when
        newEmployee: EmployeeTestSignal() from entry-point "signals"
        agent: Ava(onboardingStage == null)
    then
        modify(agent) {
            addConnection("email", newEmployee.employee.getEmail()),
            addConnection("armory", Utils.randomGenerator()),
            setOnboardingStage(OnboardingStage.AVA_CREATED)};
        EmployeeProfile profile = new EmployeeProfile(newEmployee.employee);
        insert(profile);
        delete(newEmployee);
end

rule "Update existing employee"
    when
        employee: EmployeeTestSignal() from entry-point "signals"
        profile: EmployeeProfile()
        agent: Ava(onboardingStage != null)
    then
        delete(employee);
        modify(agent) {addConnection("email", employee.getEmployee().getEmail())};
        modify(profile) {
            setFirstName(employee.getEmployee().getFirstName()),
            setLastName(employee.getEmployee().getLastName()),
            setEmail(employee.getEmployee().getEmail()),
            setActive(employee.getEmployee().getActive())};
        agent.send(CultureMaster.ID, new EmployeeUpdateSignal(profile));
end

rule "Update other employees data"
    when
        signal: AllEmployees(allEmployees: allEmployees) from entry-point "signals"
        agent: Ava()
        employee: EmployeeProfile()
    then
        allEmployees.remove(agent.getId());
        modify(agent) {
            setOtherEmployees(allEmployees),
            addConnectionStrengths()};
        agent.send(CultureMaster.ID, new EmployeeConnectionStrengthsSignal(
                employee.getId(),
                agent.getConnectionStrengthAsValue()));
        delete(signal);
end