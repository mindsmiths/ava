package rules.ava;

import com.mindsmiths.employeeManager.ManualTriggerEvent;

import agents.Ava;

import models.OnboardingStage
import models.OnboardingTemplates;
import models.LunchCycleData;
import models.MonthlyCoreData
import com.mindsmiths.employeeManager.employees.Employee

rule "Trigger onboarding"
    when
        signal: ManualTriggerEvent(triggerType == "onboarding") from entry-point "signals"
        agent: Ava(familiarity: familiarity, onboarded == false)
        employee: Employee()
    then
        agent.sendEmail(OnboardingTemplates.welcomeEmail(employee, agent.getConnection("armory"),
                                        agent.getConnection("email")));
        modify(agent) {setOnboardingStage(OnboardingStage.WELCOME_EMAIL_SENT)};
        delete(signal);
end

rule "Manual delete lunch cycle data"
    when
        signal: ManualTriggerEvent(triggerType == "lunch_cycle") from entry-point "signals"
        agent: Ava(onboardingStage == OnboardingStage.FINISHED)
        lunchCycleData: LunchCycleData()
    then
        delete(lunchCycleData);
end


rule "Manual delete monthly core data"
    when
        signal: ManualTriggerEvent(triggerType == "monthly_core") from entry-point "signals"
        agent: Ava(onboardingStage == OnboardingStage.FINISHED)
        monthlyCoreData: MonthlyCoreData()
    then
        delete(monthlyCoreData);
end